<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>

    <!-- Bootstrap -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/font-awesome.min.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>

    <h1 id="info">Please allow access to your camera!</h1>
        <h1 id="infom"></h1>
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-sm-4">
                <div class="col-xs-12 box video">
                        <canvas id="output"></canvas>
                </div>
        </div>
        <div class="col-sm-4">
          <h1>IFE Information</h1>
          <form>
            <div class="form-group">
              <label for="firstName">First Name</label>
              <input type="text" class="form-control" id="firstName" placeholder="Enter your first name">
            </div>
            <div class="form-group">
              <label for="lastName">Last Name</label>
              <input type="text" class="form-control" id="lastName" placeholder="Enter your last name">
            </div>
            <div class="form-group">
              <label for="street">Home Address</label>
              <input type="text" class="form-control" id="street" placeholder="Street and number"><br>
              <input type="text" class="form-control" id="city" placeholder="City"><br>
              <input type="text" class="form-control" id="state" placeholder="State/Province/Region"><br>
              <input type="text" class="form-control" id="zip" placeholder="ZIP">
            </div>
            <div class="form-group">
              <label for="folio">Folio</label>
              <input type="text" class="form-control" id="folio" placeholder="Enter your folio">
            </div>
            <div class="form-group">
              <label for="voterID">Voter ID</label>
              <input type="text" class="form-control" id="voterID" placeholder="Enter your voter's ID">
            </div>
            <div class="form-group">
              <label for="curp">CURP</label>
              <input type="text" class="form-control" id="curp" placeholder="Enter your CURP">
            </div>
            <div class="form-group">
              <label for="age">Age</label>
              <input type="text" class="form-control" id="age" placeholder="Enter your age">
            </div>
            <button type="submit" class="btn btn-default">Submit</button><br>
          </form>
        </div>
      </div>
    </div>




    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="/js/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/js/bootstrap.min.js"></script>

    <script>
      // requestAnimationFrame shim
          (function() {
                  var i = 0,
                          lastTime = 0,
                          vendors = ['ms', 'moz', 'webkit', 'o'];

                  while (i < vendors.length && !window.requestAnimationFrame) {
                          window.requestAnimationFrame = window[vendors[i] + 'RequestAnimationFrame'];
                          i++;
                  }

                  if (!window.requestAnimationFrame) {
                          window.requestAnimationFrame = function(callback, element) {
                                  var currTime = new Date().getTime(),
                                          timeToCall = Math.max(0, 1000 / 60 - currTime + lastTime),
                                          id = setTimeout(function() { callback(currTime + timeToCall); }, timeToCall);

                                  lastTime = currTime + timeToCall;
                                  return id;
                          };
                  }
          }());

          var App = {
                  start: function(stream) {
                          App.video.addEventListener('canplay', function() {
                                  App.video.removeEventListener('canplay');
                                  setTimeout(function() {
                                          App.video.play();
                                          App.canvas.style.display = 'inline';
                                          App.info.style.display = 'none';
                                          App.canvas.width = App.video.videoWidth/2;
                                          App.canvas.height = App.video.videoHeight/2;
                                          App.backCanvas.width = App.video.videoWidth / 4;
                                          App.backCanvas.height = App.video.videoHeight / 4;
                                          App.backContext = App.backCanvas.getContext('2d');

                                          var w = 200 / 4 * 0.8,
                                                  h = 170 / 4 * 0.8;

                                          App.comp = [{
                                                  x: (App.video.videoWidth / 4 - w) / 2,
                                                  y: (App.video.videoHeight / 4 - h) / 2,
                                                  width: w,
                                                  height: h,
                                          }];

                                          App.drawToCanvas();
                                  }, 500);
                          }, true);

                          var domURL = window.URL || window.webkitURL;
                          App.video.src = domURL ? domURL.createObjectURL(stream) : stream;
                  },
                  denied: function() {
                          App.info.innerHTML = 'Camera access denied!<br>Please reload and try again.';
                  },
                  error: function(e) {
                          if (e) {
                                  console.error(e);
                          }
                          App.info.innerHTML = 'Please go to about:flags in Google Chrome and enable the &quot;MediaStream&quot; flag.';
                  },
                  drawToCanvas: function() {
                          requestAnimationFrame(App.drawToCanvas);

                          var video = App.video,
                                  ctx = App.context,
                                  backCtx = App.backContext,
                                  m = 4,
                                  w = 4,
                                  i,
                                  comp;

                          ctx.drawImage(video, 0, 0, App.canvas.width, App.canvas.height);

                          backCtx.drawImage(video, 0, 0, App.backCanvas.width, App.backCanvas.height);


                  }
          };

          App.glasses = new Image();
          App.glasses.src = "glasses.png";

          App.init = function() {
                  App.video = document.createElement('video');
                  App.backCanvas = document.createElement('canvas');
                  App.canvas = document.querySelector('#output');
                  App.canvas.style.display = 'none';
                  App.context = App.canvas.getContext('2d');
                  App.info = document.querySelector('#info');

                  navigator.getUserMedia_ = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;

                  try {
                          navigator.getUserMedia_({
                                  video: true,
                                  audio: false
                          }, App.start, App.denied);
                  } catch (e) {
                          try {
                                  navigator.getUserMedia_('video', App.start, App.denied);
                          } catch (e) {
                                  App.error(e);
                          }
                  }

                  App.video.loop = App.video.muted = true;
                  App.video.load();
          };

          App.init();
  </script>
  </body>
</html>
